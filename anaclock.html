<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
<canvas id="canvas" width="20" height="20" />
<script type="text/javascript">
function anaclock() {
  var canvas = document.getElementById('canvas');
  var ctx = canvas.getContext('2d');
  var d = new Date();
  var s = d.getSeconds();
  var m = d.getMinutes();
  var h = d.getHours();
  if ( h > 12 ) h -= 12;
  var rad = 0;
  chrome.storage.local.get("color1", function(items){
    ctx.save();

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    var scolor = JSON.parse(items["color1"]);
    ctx.strokeStyle = "rgb("+scolor["r"]+","+scolor["g"]+","+scolor["b"]+")";
    ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
    ctx.shadowBlur = 3;
    ctx.shadowOffsetX = 2;
    ctx.shadowOffsetY = 2;
    // Time
    ctx.beginPath();
    ctx.moveTo(10, 0); ctx.lineTo(10, 2);
    ctx.moveTo(20, 10); ctx.lineTo(18, 10);
    ctx.moveTo(10, 20); ctx.lineTo(10, 18);
    ctx.moveTo(0, 10); ctx.lineTo(2, 10);
    ctx.stroke();

    ctx.translate(Math.ceil(canvas.width / 2), Math.ceil(canvas.height / 2));

    // Short hand
    rad = 2 * Math.PI / 12 * h + 2 * Math.PI / 12 / 60 * m - Math.PI / 2;
    ctx.moveTo(0, 0);
    ctx.lineTo(Math.ceil(6 * Math.cos(rad)), Math.ceil(6 * Math.sin(rad)));
    ctx.moveTo(0, 0);
    ctx.lineTo(Math.ceil(4 * Math.cos(rad+Math.PI)), Math.ceil(4 * Math.sin(rad+Math.PI)));
    ctx.stroke();

    // Long hand
    rad = 2 * Math.PI / 60 * m - Math.PI / 2;
    ctx.moveTo(0, 0);
    ctx.lineTo(Math.ceil(10 * Math.cos(rad)), Math.ceil(10 * Math.sin(rad)));
    ctx.moveTo(0, 0);
    ctx.lineTo(Math.ceil(4 * Math.cos(rad+Math.PI)), Math.ceil(4 * Math.sin(rad+Math.PI)));
    ctx.stroke();

    ctx.restore();

    chrome.browserAction.setIcon({
      "imageData": ctx.getImageData(0, 0, canvas.width, canvas.height)
    });
  });
}

anaclock();
setInterval(anaclock, 500);

</script>
</body>
</html>
