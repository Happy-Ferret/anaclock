<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
<canvas id="canvas" width="20" height="20" />
<script type="text/javascript">
function anaclock() {
  var canvas = document.getElementById('canvas');
  var ctx = canvas.getContext('2d');
  var d = new Date();
  var s = d.getSeconds();
  var m = d.getMinutes();
  var h = d.getHours();
  if ( h > 12 ) h -= 12;
  var rad = 0;
  chrome.storage.local.get("color1", function(items){
    ctx.save();

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = items["color1"];
    ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
    ctx.shadowBlur = 3;
    ctx.shadowOffsetX = 2;
    ctx.shadowOffsetY = 2;
    ctx.beginPath();
    ctx.moveTo(10, 0);
    ctx.lineTo(10, 2);
    ctx.moveTo(20, 10);
    ctx.lineTo(18, 10);
    ctx.moveTo(10, 20);
    ctx.lineTo(10, 18);
    ctx.moveTo(0, 10);
    ctx.lineTo(2, 10);
    ctx.stroke();

    ctx.translate(
      Math.ceil(canvas.width / 2),
      Math.ceil(canvas.height / 2)
    );

    ctx.moveTo(0, 0);
    rad = 2 * Math.PI / 12 * h + 2 * Math.PI / 12 / 60 * m - Math.PI / 2;
    ctx.rotate(rad);
    ctx.lineTo(6, 0);
    ctx.rotate(rad * -1);

    ctx.moveTo(0, 0);
    rad = 2 * Math.PI / 60 * m - Math.PI / 2;
    ctx.rotate(rad);
    ctx.lineTo(8, 0);
    ctx.rotate(rad * -1);

    ctx.moveTo(0, 0);
    ctx.stroke();

    ctx.restore();

    chrome.browserAction.setIcon({
      "imageData": ctx.getImageData(0, 0, canvas.width, canvas.height)
    });
  });
}

anaclock();
setInterval(anaclock, 1000);

</script>
</body>
</html>
